#!/bin/bash
apt-get -y update
apt-get -y upgrade
apt-get -y install git-core
groupadd elasticwulf
useradd -d /mnt/elasticwulf -m -g elasticwulf elasticwulf
ln -s /mnt/elasticwulf /home/elasticwulf
chmod 775 -R /home/elasticwulf/ 
chown -R elasticwulf:elasticwulf /home/elasticwulf
repository=<%= APP_CONFIG['repository'] %>
aws_access_key_id=<%= APP_CONFIG['aws_access_key_id'] %>
aws_secret_access_key=<%= APP_CONFIG['aws_secret_access_key'] %>
admin_user=<%= APP_CONFIG['admin_user'] %>
admin_password=<%= APP_CONFIG['admin_password'] %>
rest_url=<%= self.mpi_service_rest_url %>
user_packages=<%= self.user_packages %>
job_id=<%= self.id %>
cd /home/elasticwulf
su - elasticwulf -c "git clone $repository"
bash /home/elasticwulf/elasticwulf-service/lib/bootscripts/ubuntu_installs.sh $aws_access_key_id $aws_secret_access_key $admin_user $admin_password $rest_url $user_packages $job_id